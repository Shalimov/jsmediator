!function(t){"use strict";function e(t,e){e=n.extend({emitHistory:!1,emitHistoryLength:0},e),this._eventEmitter=t,this._components={},this._settings=e,this._emitHistory=e.emitHistory?[]:null}var n={each:function(t,e,n){var o,i;if(Array.isArray(t))for(o=0,i=t.length;i>o&&!e.call(n,t[o],o,t);o++);else if("object"==typeof t){var r=Object.keys(t);for(o=0,i=r.length;i>o;o++){var s=r[o];if(e.call(n,t[s],s,t))break}}},extend:function(t,e){return this.each(e,function(e,n){t[n]=e}),t}};n.extend(e,{EVENTS:{ADD:"mediator:component:add",REMOVE:"mediator:component:remove"}}),n.extend(e.prototype,{_pushEmitHistory:function(t,e){this._settings.emitHistory&&(this._emitHistory.push({component:t,event:e}),this._emitHistory.length>this._settings.emitHistoryLength&&this._emitHistory.shift())},addComponent:function(t,o){if(this._components.hasOwnProperty(t))throw new Error("Component ["+t+"] already exist");var i=o(function(){if(!this.hasComponent(t))throw new Error("Try to emit event by unregistered component: ["+t+"]");this._eventEmitter.emit.apply(this._eventEmitter,arguments),this._pushEmitHistory(t,arguments[0])}.bind(this));if("object"!=typeof i)throw new Error("Component: ["+t+"] -> mediator#registrator function should return an object");i.hasOwnProperty("onEvents")&&(n.each(i.onEvents,function(e,n){this._eventEmitter.on(n+"."+t,e)},this),delete i.onEvents),this._components[t]=i,this._eventEmitter.emit(e.EVENTS.ADD,t,i)},removeComponent:function(t){this._eventEmitter.off("."+t);var n=delete this._components[t];return n&&this._eventEmitter.emit(e.EVENTS.REMOVE,t),n},hasComponent:function(t){return!!this._components[t]},getComponent:function(t){return this._components[t]},componentsList:function(){return Object.keys(this._components)},shareResponsibility:function(t){t instanceof e&&(this._eventEmitter=t._eventEmitter)},toString:function(){return"[object Mediator]"}}),"undefined"!=typeof module&&module.exports?exports=module.exports=e:t.Mediator=e}(this);